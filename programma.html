<!DOCTYPE html>
<html>
<head>
    <title>Nanonauten in actie</title>
</head>
<body>

<script>
    // CONSTANTEN
    var CANVAS_BREEDTE = 800;
    var CANVAS_HOOGTE = 600;
    var NANONAUT_BREEDTE = 181;
    var NANONAUT_HOOGTE = 229;
    var GROND_Y = 540;
    var NANONAUT_Y_VERSNELLING = 1;
    var NANONAUT_X_SNELHEID = 2;
    var SPATIEBALK_CODE = 32;
    var NANONAUT_SPRONG_SNELHEID = 20;
    var ACHTERGROND_BREEDTE = 1000;
    var NANONAUT_FRAMES_PER_RIJ = 5;
    var NANONAUT_NR_ANIMATIEFRAMES = 7;
    var NANONAUT_ANIMATIE_SNELHEID = 3;

    // INSTELLINGEN
    var canvas = document.createElement('canvas');
    var c = canvas.getContext('2d');
    canvas.width = CANVAS_BREEDTE;
    canvas.height = CANVAS_HOOGTE;
    document.body.appendChild(canvas);

    var nanonautAfbeelding = new Image();
    nanonautAfbeelding.src = 'geanimeerdeNanonaut.png';
    var nanonautX = CANVAS_BREEDTE / 2;
    var nanonautY = GROND_Y - NANONAUT_HOOGTE;
    var nanonautYSnelheid = 0;
    var spatieBalkIsIngedrukt = false;
    var nanonautIsInDeLucht = false;
    var nanonautFrameNr = 0;
    var spelFrameTeller = 0;
    var cameraX = 0;

    var achtergrondAfbeelding = new Image();
    achtergrondAfbeelding.src = 'achtergrond.png';
    var bosje1Afbeelding = new Image();
    bosje1Afbeelding.src = 'bosje1.png';
    var bosje2Afbeelding = new Image();
    bosje2Afbeelding.src = 'bosje2.png';

    var bosjesData = genereerBosjes();

    var cameraY = 0;


    window.addEventListener('keydown', onKeyDown)
    window.addEventListener('keyup', onKeyUp)
    window.addEventListener('load', start);

    function start() {
        window.requestAnimationFrame(hoofdLus);
    }

    function genereerBosjes() {
        var gegenereerdeBosjesData =[];
        var bosjeX = 0;
        while (bosjeX < (2 * CANVAS_BREEDTE)) {
            var bosjeAfbeelding;
            if (Math.random() > 0.5) {
                bosjeAfbeelding = bosje1Afbeelding
            } else {
                bosjeAfbeelding = bosje2Afbeelding
            }
            gegenereerdeBosjesData.push({
                x: bosjeX,
                y: 80 + Math.random() * 20,
                image: bosjeAfbeelding
            })
            bosjeX += 150 + Math.random()*200
        }

        return gegenereerdeBosjesData;
    }

    // HOOLFD-LUS
    function hoofdLus() {
        update();
        draw();
        window.requestAnimationFrame(hoofdLus);
    }
    // SPELER-HANDELINGEN

    function onKeyDown(event) {
        if (event.keyCode === SPATIEBALK_CODE) {
            spatieBalkIsIngedrukt = true;
        }
    }

    function onKeyUp(event) {
        if (event.keyCode === SPATIEBALK_CODE) {
            spatieBalkIsIngedrukt = false;
        }
    }

    // UPDATEN
    function update() {
        nanonautY = nanonautY + nanonautYSnelheid;
        nanonautYSnelheid = nanonautYSnelheid + NANONAUT_Y_VERSNELLING;

        nanonautX = nanonautX + NANONAUT_X_SNELHEID;

        if (nanonautY > (GROND_Y - NANONAUT_HOOGTE)) {
            nanonautY = GROND_Y - NANONAUT_HOOGTE;
            nanonautYSnelheid = 0;
            nanonautIsInDeLucht = false;
        }

        if (spatieBalkIsIngedrukt && !nanonautIsInDeLucht) {
            nanonautYSnelheid = -NANONAUT_SPRONG_SNELHEID;
            nanonautIsInDeLucht = true;
        }

        // update de camera
        cameraX = nanonautX - 150

        if (!nanonautIsInDeLucht) {
            spelFrameTeller = spelFrameTeller + 1;

            if (spelFrameTeller % NANONAUT_ANIMATIE_SNELHEID === 0) {
                nanonautFrameNr = nanonautFrameNr + 1;
                if (nanonautFrameNr >= NANONAUT_NR_ANIMATIEFRAMES) {
                    nanonautFrameNr = 0;
                }
            }
        }

        // update bosjes
        for (let i = 0; i < bosjesData.length; i++) {
            if (bosjesData[i].x - cameraX < - CANVAS_BREEDTE) {
                bosjesData[i].x += 2 * CANVAS_BREEDTE + 150;
            }
        }
    }
    // TEKENEN
    function draw() {
        //teken de lucht
        c.fillStyle = 'LightSkyBlue';
        c.fillRect(0, 0, CANVAS_BREEDTE, GROND_Y - 40);

        //teken de achtergrond
        var achtergrondX = -(cameraX % ACHTERGROND_BREEDTE)
        c.drawImage(achtergrondAfbeelding, achtergrondX, -210)
        c.drawImage(achtergrondAfbeelding, achtergrondX + ACHTERGROND_BREEDTE, -210)
        //teken de grond
        c.fillStyle = 'forestgreen';
        c.fillRect(0, GROND_Y -40, CANVAS_BREEDTE, CANVAS_HOOGTE - GROND_Y + 40)

        for (var i=0; i<bosjesData.length; i++) {

            c.drawImage(bosjesData[i].image, bosjesData[i].x - cameraX, GROND_Y - bosjesData[i].y - cameraY)
        }

        // teken de nanonaut
        var nanonautSpriteSheetRij = Math.floor(nanonautFrameNr / NANONAUT_FRAMES_PER_RIJ);
        var nanonautSpriteSheetKolom = nanonautFrameNr % NANONAUT_FRAMES_PER_RIJ;
        var nanonautSpriteSheetX = nanonautSpriteSheetKolom * NANONAUT_BREEDTE;
        var nanonautSpriteSheetY = nanonautSpriteSheetRij * NANONAUT_HOOGTE;
        c.drawImage(nanonautAfbeelding, nanonautSpriteSheetX, nanonautSpriteSheetY,
            NANONAUT_BREEDTE, NANONAUT_HOOGTE, nanonautX - cameraX, nanonautY - cameraY,
            NANONAUT_BREEDTE, NANONAUT_HOOGTE)
    }

</script>
</body>
</html>